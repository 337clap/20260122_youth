import streamlit as st
import pandas as pd
import numpy as np

# ================================
# ğŸ”¥ 1. í˜ì´ì§€ ê¸°ë³¸ ì„¤ì • (ë¸Œëœë”©)
# ================================
st.set_page_config(
    page_title="DIGI BALANCE",
    page_icon="ğŸŒ±",
    layout="centered"
)

# ================================
# ğŸ”¥ 2. ì•± ì œëª© + ìŠ¬ë¡œê±´ (UI ê°ì„± í•µì‹¬)
# ================================
st.markdown("""
<h1 style='text-align: center;'>ğŸŒ± DIGI BALANCE</h1>
<h4 style='text-align: center; color: gray;'>ë‚˜ë¥¼ ìœ„í•œ ìŠ¤ë§ˆíŠ¸í•œ ë””ì§€í„¸ ìŠµê´€</h4>
<p style='text-align: center; color: #888;'>ê³µê³µë°ì´í„° ê¸°ë°˜ + ë‚˜ì˜ ê¸°ë¡ìœ¼ë¡œ ë””ì§€í„¸ ë°¸ëŸ°ìŠ¤ë¥¼ ê´€ë¦¬í•´ìš”</p>
<hr>
""", unsafe_allow_html=True)

# ================================
# 3. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
# ================================
df_view = pd.read_csv("online viewing.csv", encoding="utf-8-sig")
df_usage = pd.read_csv("daily_usage.csv", encoding="utf-8-sig")

# ================================
# 4. ì‚¬ìš©ì ì…ë ¥ UI
# ================================
st.header("ğŸ‘¤ ë‚´ ì •ë³´")

col1, col2 = st.columns(2)
with col1:
    age = st.number_input("ë‚˜ì´", min_value=10, max_value=19, value=15)
with col2:
    gender = st.radio("ì„±ë³„", ["ë‚¨", "ì—¬"], horizontal=True)

st.header("ğŸ“Š ì˜¤ëŠ˜ì˜ ë””ì§€í„¸ í™œë™")

total_time = st.slider(
    "ì˜¤ëŠ˜ ìŠ¤ë§ˆíŠ¸í° ì´ ì‚¬ìš© ì‹œê°„ (ë¶„)",
    min_value=0,
    max_value=720,
    value=240,
    step=10
)

video_time = st.slider(
    "ì˜¤ëŠ˜ ì˜ìƒ ì‹œì²­ ì‹œê°„ (ë¶„)",
    min_value=0,
    max_value=total_time,
    value=120,
    step=10
)

# ================================
# 5. ë¶„ì„ ë²„íŠ¼
# ================================
if st.button("ğŸ§  ì˜¤ëŠ˜ì˜ ë””ì§€í„¸ ë°¸ëŸ°ìŠ¤ ì§„ë‹¨í•˜ê¸°"):
    st.divider()

    # ================================
    # ğŸ”¥ 6. ìœ„í—˜ë„ íŒë‹¨ ë¡œì§
    # ================================
    if video_time < 60:
        level = "ğŸŸ¢ ì•ˆì „"
        msg = "ì•„ì£¼ ì¢‹ì•„ìš”! ì§€ê¸ˆ ìŠµê´€ì„ ìœ ì§€í•´ë³´ì„¸ìš” ğŸ˜Š"
        off = "10ë¶„ íœ´ì‹"
    elif video_time < 120:
        level = "ğŸŸ¡ ì£¼ì˜"
        msg = "ì¡°ê¸ˆë§Œ ì¤„ì´ë©´ ë” ì¢‹ì•„ì§ˆ ìˆ˜ ìˆì–´ìš” ğŸ™‚"
        off = "20ë¶„ OFF"
    else:
        level = "ğŸ”´ ìœ„í—˜"
        msg = "ì˜¤ëŠ˜ì€ ì˜ìƒ ì‚¬ìš©ì´ ë§ì•„ìš” ğŸ˜µâ€ğŸ’«"
        off = "30ë¶„ OFF"

    st.subheader(f"ì˜¤ëŠ˜ì˜ ìƒíƒœ: {level}")
    st.write(msg)

    # ================================
    # ğŸ”¥ 7. ë˜ë˜ í‰ê·  ë¹„êµ (ë°ì´í„° ê¸°ë°˜ í•µì‹¬)
    # ================================
    # â€» ë‚˜ì¤‘ì— ì‹¤ì œ ê³µê³µë°ì´í„° í‰ê· ìœ¼ë¡œ êµì²´ ê°€ëŠ¥
    avg = 195  

    st.write("### ğŸ“ˆ ë˜ë˜ í‰ê· ê³¼ ë¹„êµ")

    chart_df = pd.DataFrame({
        "êµ¬ë¶„": ["ë‚˜", "ë˜ë˜ í‰ê· "],
        "ì‚¬ìš© ì‹œê°„(ë¶„)": [total_time, avg]
    })

    st.bar_chart(chart_df.set_index("êµ¬ë¶„"))

    diff = total_time - avg
    if diff > 0:
        st.warning(f"í‰ê· ë³´ë‹¤ {diff}ë¶„ ë” ì‚¬ìš©í–ˆì–´ìš” âš ï¸")
    else:
        st.success("ë˜ë˜ í‰ê· ë³´ë‹¤ ì ê²Œ ì‚¬ìš©í–ˆì–´ìš” ğŸ‘")

    # ================================
    # ğŸ”¥ 8. AI ìŠ¤íƒ€ì¼ í–‰ë™ ì½”ì¹­
    # ================================
    st.write("### ğŸ¯ ì˜¤ëŠ˜ì˜ ë””ì§€í„¸ ì½”ì¹­")

    st.info(f"âœ” ìŠ¤ë§ˆíŠ¸í° {off}")
    st.info("âœ” ì‚°ì±… 10ë¶„ ğŸš¶")
    st.info("âœ” ëˆˆ íœ´ì‹ 5ë¶„ ğŸ‘€")
    st.info("âœ” ìŠ¤íŠ¸ë ˆì¹­ 5ë¶„ ğŸ§˜")
    st.info("âœ” ì±… 10í˜ì´ì§€ ğŸ“–")

    st.balloons()

# ================================
# 9. í•˜ë‹¨ ì•ˆë‚´
# ================================
st.caption("â€» ë³¸ ì„œë¹„ìŠ¤ëŠ” ê³µê³µ í†µê³„ ê¸°ë°˜ ë””ì§€í„¸ ìŠµê´€ ê´€ë¦¬ ì‹¤í—˜ìš© ì•±ì…ë‹ˆë‹¤.")
